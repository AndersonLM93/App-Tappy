 .video-container {
        aspect-ratio: 9/16;
        max-height: 70vh;
    }
    
    .map-pin {
        animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }
    
    .fade-in {
        animation: fadeIn 0.8s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-in-right {
        animation: slideInRight 0.5s ease-out;
    }
    
    @keyframes slideInRight {
        from { transform: translateX(100%); }
        to { transform: translateX(0); }
    }
    
    .slide-in-left {
        animation: slideInLeft 0.5s ease-out;
    }
    
    @keyframes slideInLeft {
        from { transform: translateX(-100%); }
        to { transform: translateX(0); }
    }
    
    .zoom-in {
        animation: zoomIn 0.3s ease-out;
    }
    
    @keyframes zoomIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }
    
    .heart-bounce {
        animation: heartBounce 0.6s ease-out;
    }
    
    @keyframes heartBounce {
        0% { transform: scale(1); }
        50% { transform: scale(1.3); }
        100% { transform: scale(1); }
    }
    
    .pulse-location {
        animation: pulseLocation 2s infinite;
    }
    
    @keyframes pulseLocation {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.7; }
        100% { transform: scale(1); opacity: 1; }
    }
    
    .camera-bounce {
        animation: cameraBounce 2s infinite;
    }
    
    @keyframes cameraBounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
    
    .gradient-bg {
        background: linear-gradient(135deg, #1E90FF 0%, #FFD700 100%);
    }
    
    .video-bg {
        background: linear-gradient(45deg, rgba(30,144,255,0.1), rgba(255,215,0,0.1));
        background-size: 400% 400%;
        animation: gradientShift 8s ease infinite;
    }
    
    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .hover-scale {
        transition: transform 0.2s ease;
    }
    
    .hover-scale:hover {
        transform: scale(1.05);
    }
    
    .btn-hover {
        transition: all 0.3s ease;
    }
    
    .btn-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    .modal-overlay {
        backdrop-filter: blur(5px);
    }
    
    /* Estilos customizados para o Mapbox */
    .mapboxgl-popup-content {
        border-radius: 12px !important;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2) !important;
    }
    
    .mapboxgl-popup-tip {
        border-top-color: white !important;
    }
    
    .business-marker {
        cursor: pointer;
        transition: transform 0.2s ease;
    }
    
    .business-marker:hover {
        transform: scale(1.1);
    }
    
    .user-marker {
        z-index: 1000;
    }
    
    /* Controles do mapa customizados */
    .mapboxgl-ctrl-group {
        border-radius: 12px !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    }
    
    .mapboxgl-ctrl button {
        border-radius: 8px !important;
    }
</style>

    <div class="w-full max-w-sm space-y-4">
        <button onclick="showScreen('signup-screen')" class="w-full bg-tappy-gold text-gray-800 py-4 rounded-full font-semibold text-lg shadow-lg btn-hover">
            Criar Conta
        </button>
        <button onclick="showScreen('login-screen')" class="w-full border-2 border-white text-white py-4 rounded-full font-semibold text-lg btn-hover hover:bg-white hover:text-tappy-blue">
            Entrar
        </button>
    </div>
    
    <!-- Elementos decorativos animados -->
    <div class="absolute top-20 left-10 w-4 h-4 bg-white rounded-full opacity-30 animate-ping"></div>
    <div class="absolute bottom-32 right-16 w-6 h-6 bg-tappy-gold rounded-full opacity-40 animate-bounce"></div>
    <div class="absolute top-1/3 right-8 w-3 h-3 bg-white rounded-full opacity-50 animate-pulse"></div>
</div>

<!-- Tela de Cadastro -->
<div id="signup-screen" class="hidden min-h-screen gradient-bg p-6">
    <div class="max-w-md mx-auto">
        <button onclick="showScreen('welcome-screen')" class="mb-6 text-white hover:text-tappy-gold transition-colors">
            ‚Üê Voltar
        </button>
        <h2 class="text-3xl font-bold text-white mb-8 text-center">Criar Conta</h2>
        
        <div class="bg-white rounded-3xl p-6 shadow-2xl zoom-in">
            <div class="mb-6 text-center">
                <div class="w-24 h-24 bg-tappy-gray rounded-full mx-auto mb-4 flex items-center justify-center hover-scale cursor-pointer">
                    <span class="text-gray-400 text-2xl">üì∑</span>
                </div>
                <button class="text-tappy-blue font-semibold hover:text-blue-600 transition-colors">Adicionar Foto</button>
            </div>
            
            <div class="space-y-4">
                <div class="relative">
                    <span class="absolute left-4 top-4 text-gray-400">üë§</span>
                    <input type="text" placeholder="Nome completo" class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:border-tappy-blue focus:outline-none transition-colors">
                </div>
                <div class="relative">
                    <span class="absolute left-4 top-4 text-gray-400">üìß</span>
                    <input type="email" placeholder="E-mail" class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:border-tappy-blue focus:outline-none transition-colors">
                </div>
                <div class="relative">
                    <span class="absolute left-4 top-4 text-gray-400">üîí</span>
                    <input type="password" placeholder="Senha" class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:border-tappy-blue focus:outline-none transition-colors">
                </div>
                
                <button class="w-full flex items-center justify-center space-x-2 p-4 border-2 border-tappy-blue rounded-xl text-tappy-blue hover:bg-tappy-blue hover:text-white transition-all pulse-location">
                    <span class="text-xl">üìç</span>
                    <span class="font-semibold">Usar minha localiza√ß√£o</span>
                </button>
            </div>
            
            <button onclick="showMainApp()" class="w-full bg-tappy-blue text-white py-4 rounded-xl font-semibold mt-6 btn-hover">
                Criar Conta
            </button>
        </div>
    </div>
</div>

<!-- Tela de Login -->
<div id="login-screen" class="hidden min-h-screen gradient-bg p-6">
    <div class="max-w-md mx-auto">
        <button onclick="showScreen('welcome-screen')" class="mb-6 text-white hover:text-tappy-gold transition-colors">
            ‚Üê Voltar
        </button>
        <h2 class="text-3xl font-bold text-white mb-8 text-center">Entrar</h2>
        
        <div class="bg-white rounded-3xl p-6 shadow-2xl zoom-in">
            <div class="space-y-4">
                <div class="relative">
                    <span class="absolute left-4 top-4 text-gray-400">üìß</span>
                    <input type="email" placeholder="E-mail" class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:border-tappy-blue focus:outline-none transition-colors">
                </div>
                <div class="relative">
                    <span class="absolute left-4 top-4 text-gray-400">üîí</span>
                    <input type="password" placeholder="Senha" class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:border-tappy-blue focus:outline-none transition-colors">
                </div>
            </div>
            
            <button onclick="showMainApp()" class="w-full bg-tappy-blue text-white py-4 rounded-xl font-semibold mt-6 btn-hover">
                Entrar
            </button>
            
            <p class="text-center text-gray-600 mt-4">
                N√£o tem conta? 
                <button onclick="showScreen('signup-screen')" class="text-tappy-blue font-semibold hover:text-blue-600 transition-colors">Criar agora</button>
            </p>
        </div>
    </div>
</div>

<!-- App Principal -->
<div id="main-app" class="hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm p-4 flex items-center justify-between sticky top-0 z-40">
        <h1 class="text-2xl font-bold text-tappy-blue">Tappy</h1>
        <div class="flex items-center space-x-3">
            <button class="text-2xl hover-scale">üîç</button>
            <button onclick="toggleNotifications()" class="relative text-2xl hover-scale">
                <span id="notification-icon">üîî</span>
                <span id="notification-badge" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden">3</span>
            </button>
            <div class="w-8 h-8 bg-gradient-to-r from-tappy-blue to-tappy-gold rounded-full hover-scale"></div>
        </div>
    </header>

    <!-- Feed de V√≠deos -->
    <div id="feed-tab" class="tab-content pb-20">
        <div class="space-y-0">
            <!-- V√≠deo 1 -->
            <div class="bg-white shadow-lg">
                <div class="flex items-center p-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-tappy-gold to-yellow-400 rounded-full mr-3 hover-scale"></div>
                    <div class="flex-1">
                        <h3 class="font-semibold">Padaria do Jo√£o</h3>
                        <p class="text-gray-500 text-sm">üìç 500m ‚Ä¢ h√° 2 horas</p>
                    </div>
                    <button class="text-gray-400 hover:text-gray-600">‚ãØ</button>
                </div>
                
                <div class="video-container bg-gradient-to-br from-amber-100 to-orange-200 flex items-center justify-center relative cursor-pointer" onclick="toggleVideo(this)">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto mb-2 shadow-lg hover-scale">
                            <span class="text-tappy-blue text-2xl play-btn">‚ñ∂</span>
                        </div>
                        <p class="text-gray-700 font-medium">P√£es frescos saindo do forno!</p>
                    </div>
                    <div class="absolute inset-0 bg-black bg-opacity-0 transition-all duration-300 hover:bg-opacity-10"></div>
                </div>
                
                <div class="p-4">
                    <p class="mb-4 text-gray-800">Nossos p√£es artesanais s√£o feitos com ingredientes selecionados! üçû‚ú® #P√£oArtesanal #FrescoTodosDias</p>
                    <div class="flex items-center justify-between">
                        <div class="flex space-x-6">
                            <button onclick="likeVideo(this)" class="flex items-center space-x-2 text-gray-600 hover:text-red-500 transition-colors like-btn">
                                <span class="text-xl">ü§ç</span>
                                <span class="like-count">124</span>
                            </button>
                            <button onclick="openComments()" class="flex items-center space-x-2 text-gray-600 hover:text-tappy-blue transition-colors">
                                <span class="text-xl">üí¨</span>
                                <span>12</span>
                            </button>
                            <button onclick="shareVideo()" class="text-gray-600 hover:text-tappy-blue transition-colors">
                                <span class="text-xl">üì§</span>
                            </button>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">üîñ</button>
                    </div>
                </div>
            </div>

            <!-- V√≠deo 2 -->
            <div class="bg-white shadow-lg">
                <div class="flex items-center p-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-pink-400 to-purple-400 rounded-full mr-3 hover-scale"></div>
                    <div class="flex-1">
                        <h3 class="font-semibold">Maria - Nail Designer</h3>
                        <p class="text-gray-500 text-sm">üìç 300m ‚Ä¢ h√° 1 hora</p>
                    </div>
                    <button class="text-gray-400 hover:text-gray-600">‚ãØ</button>
                </div>
                
                <div class="video-container bg-gradient-to-br from-pink-100 to-purple-200 flex items-center justify-center relative cursor-pointer" onclick="toggleVideo(this)">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto mb-2 shadow-lg hover-scale">
                            <span class="text-tappy-blue text-2xl play-btn">‚ñ∂</span>
                        </div>
                        <p class="text-gray-700 font-medium">Nail art incr√≠vel em processo!</p>
                    </div>
                </div>
                
                <div class="p-4">
                    <p class="mb-4 text-gray-800">Unhas decoradas com muito carinho e t√©cnica! Agende seu hor√°rio üíÖ‚ú® #NailArt #UnhasDecoradas</p>
                    <div class="flex items-center justify-between">
                        <div class="flex space-x-6">
                            <button onclick="likeVideo(this)" class="flex items-center space-x-2 text-gray-600 hover:text-red-500 transition-colors like-btn">
                                <span class="text-xl">ü§ç</span>
                                <span class="like-count">89</span>
                            </button>
                            <button onclick="openComments()" class="flex items-center space-x-2 text-gray-600 hover:text-tappy-blue transition-colors">
                                <span class="text-xl">üí¨</span>
                                <span>8</span>
                            </button>
                            <button onclick="shareVideo()" class="text-gray-600 hover:text-tappy-blue transition-colors">
                                <span class="text-xl">üì§</span>
                            </button>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">üîñ</button>
                    </div>
                </div>
            </div>

            <!-- V√≠deo 3 -->
            <div class="bg-white shadow-lg">
                <div class="flex items-center p-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-400 rounded-full mr-3 hover-scale"></div>
                    <div class="flex-1">
                        <h3 class="font-semibold">Caf√© da Esquina</h3>
                        <p class="text-gray-500 text-sm">üìç 800m ‚Ä¢ h√° 30 min</p>
                    </div>
                    <button class="text-gray-400 hover:text-gray-600">‚ãØ</button>
                </div>
                
                <div class="video-container bg-gradient-to-br from-green-100 to-blue-200 flex items-center justify-center relative cursor-pointer" onclick="toggleVideo(this)">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto mb-2 shadow-lg hover-scale">
                            <span class="text-tappy-blue text-2xl play-btn">‚ñ∂</span>
                        </div>
                        <p class="text-gray-700 font-medium">Latte art em a√ß√£o!</p>
                    </div>
                </div>
                
                <div class="p-4">
                    <p class="mb-4 text-gray-800">O caf√© mais cremoso da regi√£o! Venha experimentar nosso latte especial ‚òïÔ∏è‚ù§Ô∏è #LatteArt #Caf√©Especial</p>
                    <div class="flex items-center justify-between">
                        <div class="flex space-x-6">
                            <button onclick="likeVideo(this)" class="flex items-center space-x-2 text-gray-600 hover:text-red-500 transition-colors like-btn">
                                <span class="text-xl">ü§ç</span>
                                <span class="like-count">156</span>
                            </button>
                            <button onclick="openComments()" class="flex items-center space-x-2 text-gray-600 hover:text-tappy-blue transition-colors">
                                <span class="text-xl">üí¨</span>
                                <span>23</span>
                            </button>
                            <button onclick="shareVideo()" class="text-gray-600 hover:text-tappy-blue transition-colors">
                                <span class="text-xl">üì§</span>
                            </button>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">üîñ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mapa de Neg√≥cios -->
    <div id="map-tab" class="tab-content hidden pb-20">
        <div class="h-screen relative">
            <!-- Container do Mapbox -->
            <div id="mapbox-container" class="w-full h-full"></div>
            
            <!-- Card lateral do neg√≥cio -->
            <div id="business-card" class="hidden absolute bottom-20 left-4 right-4 bg-white rounded-2xl p-6 shadow-2xl slide-in-right z-10">
                <div id="business-card-content">
                    <!-- Conte√∫do ser√° preenchido dinamicamente -->
                </div>
            </div>
            
            <!-- Controles do mapa -->
            <div class="absolute top-4 right-4 space-y-2 z-10">
                <button onclick="centerMapOnUser()" class="w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center hover-scale">
                    <span class="text-xl">üéØ</span>
                </button>
                <button onclick="toggleMapStyle()" class="w-12 h-12 bg-white rounded-full shadow-lg flex items-center justify-center hover-scale">
                    <span class="text-xl">üó∫Ô∏è</span>
                </button>
            </div>
            
            <!-- Legenda -->
            <div class="absolute bottom-20 left-4 right-4 bg-white rounded-xl p-4 shadow-lg z-10">
                <h3 class="font-semibold mb-2">Neg√≥cios pr√≥ximos</h3>
                <div class="flex items-center justify-between text-sm">
                    <span class="flex items-center"><span class="mr-2">üçû</span>Padarias</span>
                    <span class="flex items-center"><span class="mr-2">üíÖ</span>Beleza</span>
                    <span class="flex items-center"><span class="mr-2">‚òï</span>Caf√©s</span>
                    <span class="flex items-center"><span class="mr-2">üõçÔ∏è</span>Lojas</span>
                </div>
            </div>
            
            <!-- Loading do mapa -->
            <div id="map-loading" class="absolute inset-0 bg-white flex items-center justify-center z-20">
                <div class="text-center">
                    <div class="w-16 h-16 bg-tappy-blue rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                        <span class="text-white text-2xl">üó∫Ô∏è</span>
                    </div>
                    <p class="text-gray-600">Carregando mapa...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload de V√≠deo -->
    <div id="upload-tab" class="tab-content hidden pb-20">
        <div class="p-6">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Criar V√≠deo</h2>
            
            <div class="bg-white rounded-3xl p-6 shadow-lg">
                <div class="video-container bg-tappy-gray rounded-2xl flex items-center justify-center mb-6 cursor-pointer hover-scale">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-tappy-blue rounded-full flex items-center justify-center mx-auto mb-4 camera-bounce">
                            <span class="text-white text-3xl">üìπ</span>
                        </div>
                        <p class="text-gray-600 mb-4 font-medium">Toque para gravar seu v√≠deo</p>
                        <button class="bg-tappy-blue text-white px-8 py-3 rounded-full font-semibold btn-hover">Gravar V√≠deo</button>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="relative">
                        <span class="absolute left-4 top-4 text-gray-400">üìù</span>
                        <input type="text" placeholder="T√≠tulo do v√≠deo" class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:border-tappy-blue focus:outline-none transition-colors">
                    </div>
                    <div class="relative">
                        <span class="absolute left-4 top-4 text-gray-400">üí≠</span>
                        <textarea placeholder="Descri√ß√£o..." rows="3" class="w-full pl-12 pr-4 py-4 border border-gray-200 rounded-xl focus:border-tappy-blue focus:outline-none resize-none transition-colors"></textarea>
                    </div>
                    
                    <div class="flex items-center space-x-2 p-4 border border-gray-200 rounded-xl cursor-pointer hover:border-tappy-blue transition-colors">
                        <span class="text-xl">üìç</span>
                        <span class="text-gray-600 flex-1">S√£o Paulo, SP - Brasil</span>
                        <span class="text-tappy-blue text-sm">Alterar</span>
                    </div>
                    
                    <div class="flex items-center space-x-2 p-4 border border-gray-200 rounded-xl">
                        <span class="text-xl">üè∑Ô∏è</span>
                        <input type="text" placeholder="Adicionar tags..." class="flex-1 outline-none">
                    </div>
                </div>
                
                <button class="w-full bg-tappy-gold text-gray-800 py-4 rounded-xl font-semibold mt-6 btn-hover">
                    Publicar V√≠deo
                </button>
            </div>
        </div>
    </div>

    <!-- Perfil do Usu√°rio -->
    <div id="profile-tab" class="tab-content hidden pb-20">
        <div class="bg-gradient-to-b from-tappy-blue to-tappy-gold p-6 text-white">
            <div class="text-center">
                <div class="w-24 h-24 bg-white rounded-full mx-auto mb-4 hover-scale"></div>
                <h2 class="text-2xl font-bold">Ana Silva</h2>
                <p class="opacity-90 mb-2">@anasilva</p>
                <p class="opacity-80 text-sm mb-4">Amante de neg√≥cios locais e descobertas incr√≠veis! üè™‚ú®</p>
                
                <div class="flex justify-center space-x-8 mb-6">
                    <div class="text-center">
                        <div class="text-xl font-bold">12</div>
                        <div class="text-sm opacity-80">V√≠deos</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold">1.2k</div>
                        <div class="text-sm opacity-80">Seguidores</div>
                    </div>
                    <div class="text-center">
                        <div class="text-xl font-bold">890</div>
                        <div class="text-sm opacity-80">Seguindo</div>
                    </div>
                </div>
                
                <button class="bg-white text-tappy-blue px-8 py-3 rounded-full font-semibold btn-hover">Editar Perfil</button>
            </div>
        </div>
        
        <div class="p-6">
            <div class="flex space-x-4 mb-6">
                <button class="flex-1 bg-tappy-blue text-white py-3 rounded-xl font-semibold">Meus V√≠deos</button>
                <button class="flex-1 bg-gray-200 text-gray-600 py-3 rounded-xl font-semibold">Curtidos</button>
            </div>
            
            <div class="grid grid-cols-3 gap-2">
                <div class="aspect-square bg-gradient-to-br from-tappy-blue to-tappy-gold rounded-lg hover-scale cursor-pointer"></div>
                <div class="aspect-square bg-gradient-to-br from-pink-400 to-purple-400 rounded-lg hover-scale cursor-pointer"></div>
                <div class="aspect-square bg-gradient-to-br from-green-400 to-blue-400 rounded-lg hover-scale cursor-pointer"></div>
                <div class="aspect-square bg-gradient-to-br from-orange-400 to-red-400 rounded-lg hover-scale cursor-pointer"></div>
                <div class="aspect-square bg-gradient-to-br from-yellow-400 to-orange-400 rounded-lg hover-scale cursor-pointer"></div>
                <div class="aspect-square bg-gradient-to-br from-indigo-400 to-purple-400 rounded-lg hover-scale cursor-pointer"></div>
            </div>
        </div>
    </div>

    <!-- Navega√ß√£o Inferior -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-6 py-2 z-50">
        <div class="flex justify-around">
            <button onclick="showTab('feed')" class="tab-btn flex flex-col items-center py-2 text-tappy-blue">
                <span class="text-2xl mb-1">üè†</span>
                <span class="text-xs font-medium">Feed</span>
            </button>
            <button onclick="showTab('map')" class="tab-btn flex flex-col items-center py-2 text-gray-400">
                <span class="text-2xl mb-1">üó∫Ô∏è</span>
                <span class="text-xs font-medium">Mapa</span>
            </button>
            <button onclick="showTab('upload')" class="tab-btn flex flex-col items-center py-2 text-gray-400">
                <span class="text-2xl mb-1">‚ûï</span>
                <span class="text-xs font-medium">Upload</span>
            </button>
            <button onclick="showTab('profile')" class="tab-btn flex flex-col items-center py-2 text-gray-400">
                <span class="text-2xl mb-1">üë§</span>
                <span class="text-xs font-medium">Perfil</span>
            </button>
        </div>
    </nav>
</div>

<!-- Modal de Coment√°rios -->
<div id="comments-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 modal-overlay">
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 zoom-in">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold">Coment√°rios (2)</h3>
            <button onclick="closeComments()" class="text-gray-400 hover:text-gray-600">‚úï</button>
        </div>
        
        <div class="space-y-4 mb-6 max-h-60 overflow-y-auto">
            <div class="flex space-x-3">
                <div class="w-8 h-8 bg-tappy-blue rounded-full"></div>
                <div class="flex-1">
                    <p class="font-semibold text-sm">Carlos</p>
                    <p class="text-gray-600 text-sm">Que del√≠cia! Vou passar a√≠ hoje! üòã</p>
                </div>
            </div>
            <div class="flex space-x-3">
                <div class="w-8 h-8 bg-tappy-gold rounded-full"></div>
                <div class="flex-1">
                    <p class="font-semibold text-sm">Mariana</p>
                    <p class="text-gray-600 text-sm">Melhor padaria da regi√£o! ‚ù§Ô∏è</p>
                </div>
            </div>
        </div>
        
        <div class="flex space-x-3">
            <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
            <input type="text" id="comment-input" placeholder="Adicione um coment√°rio..." class="flex-1 p-3 border border-gray-200 rounded-full focus:border-tappy-blue focus:outline-none">
            <button onclick="addComment()" class="bg-tappy-blue text-white px-6 py-3 rounded-full font-semibold hover:bg-blue-600 transition-colors">Enviar</button>
        </div>
    </div>
</div>

<!-- Modal de Perfil de Neg√≥cio -->
<div id="business-profile-modal" class="hidden fixed inset-0 bg-white z-50">
    <div class="p-6">
        <button onclick="closeBusinessProfile()" class="mb-4 text-tappy-blue hover:text-blue-600 transition-colors">‚Üê Voltar</button>
        
        <div id="business-profile-content" class="text-center">
            <!-- Conte√∫do ser√° preenchido dinamicamente -->
        </div>
    </div>
</div>

<!-- Modal de Contato -->
<div id="contact-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 modal-overlay">
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 zoom-in">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold">Entrar em Contato</h3>
            <button onclick="closeContactModal()" class="text-gray-400 hover:text-gray-600">‚úï</button>
        </div>
        
        <div class="space-y-4">
            <button class="w-full flex items-center space-x-4 p-4 border border-gray-200 rounded-xl hover:border-green-500 transition-colors">
                <span class="text-2xl">üì±</span>
                <div class="text-left">
                    <p class="font-semibold">WhatsApp</p>
                    <p class="text-gray-600 text-sm">Conversar pelo WhatsApp</p>
                </div>
            </button>
            
            <button class="w-full flex items-center space-x-4 p-4 border border-gray-200 rounded-xl hover:border-blue-500 transition-colors">
                <span class="text-2xl">üìß</span>
                <div class="text-left">
                    <p class="font-semibold">E-mail</p>
                    <p class="text-gray-600 text-sm">Enviar um e-mail</p>
                </div>
            </button>
            
            <button class="w-full flex items-center space-x-4 p-4 border border-gray-200 rounded-xl hover:border-blue-600 transition-colors">
                <span class="text-2xl">üìû</span>
                <div class="text-left">
                    <p class="font-semibold">Telefone</p>
                    <p class="text-gray-600 text-sm">Ligar diretamente</p>
                </div>
            </button>
        </div>
    </div>
</div>

<!-- Painel de Notifica√ß√µes -->
<div id="notifications-panel" class="hidden fixed top-16 right-4 w-80 bg-white rounded-2xl shadow-2xl z-50 max-h-96 overflow-hidden">
    <div class="p-4 border-b border-gray-100">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold text-gray-800">Notifica√ß√µes</h3>
            <div class="flex items-center space-x-2">
                <button onclick="markAllAsRead()" class="text-sm text-tappy-blue hover:text-blue-600 transition-colors">Marcar todas como lidas</button>
                <button onclick="toggleNotifications()" class="text-gray-400 hover:text-gray-600">‚úï</button>
            </div>
        </div>
    </div>
    
    <div id="notifications-list" class="max-h-80 overflow-y-auto">
        <!-- Notifica√ß√µes ser√£o inseridas aqui dinamicamente -->
    </div>
    
    <div class="p-4 border-t border-gray-100 bg-gray-50">
        <button onclick="openNotificationSettings()" class="w-full text-center text-sm text-gray-600 hover:text-tappy-blue transition-colors">
            ‚öôÔ∏è Configurar Notifica√ß√µes
        </button>
    </div>
</div>

<!-- Modal de Configura√ß√µes de Notifica√ß√£o -->
<div id="notification-settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 modal-overlay">
    <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 zoom-in">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold">Configura√ß√µes de Notifica√ß√£o</h3>
            <button onclick="closeNotificationSettings()" class="text-gray-400 hover:text-gray-600">‚úï</button>
        </div>
        
        <div class="space-y-4">
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl">
                <div>
                    <p class="font-semibold">Novos v√≠deos pr√≥ximos</p>
                    <p class="text-gray-600 text-sm">Quando neg√≥cios pr√≥ximos postam</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" checked>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-tappy-blue"></div>
                </label>
            </div>
            
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl">
                <div>
                    <p class="font-semibold">Promo√ß√µes especiais</p>
                    <p class="text-gray-600 text-sm">Ofertas e descontos exclusivos</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" checked>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-tappy-blue"></div>
                </label>
            </div>
            
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl">
                <div>
                    <p class="font-semibold">Lembretes de check-in</p>
                    <p class="text-gray-600 text-sm">Quando voc√™ est√° perto de um lugar</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-tappy-blue"></div>
                </label>
            </div>
            
            <div class="flex items-center justify-between p-4 border border-gray-200 rounded-xl">
                <div>
                    <p class="font-semibold">Intera√ß√µes sociais</p>
                    <p class="text-gray-600 text-sm">Curtidas e coment√°rios nos seus v√≠deos</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" checked>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-tappy-blue"></div>
                </label>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-tappy-gray rounded-xl">
            <h4 class="font-semibold mb-2">Hor√°rio de Sil√™ncio</h4>
            <div class="flex items-center space-x-4">
                <div class="flex-1">
                    <label class="text-sm text-gray-600">Das</label>
                    <input type="time" value="22:00" class="w-full mt-1 p-2 border border-gray-200 rounded-lg focus:border-tappy-blue focus:outline-none">
                </div>
                <div class="flex-1">
                    <label class="text-sm text-gray-600">At√©</label>
                    <input type="time" value="08:00" class="w-full mt-1 p-2 border border-gray-200 rounded-lg focus:border-tappy-blue focus:outline-none">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ===== SISTEMA DE RECOMENDA√á√ÉO INTELIGENTE TAPPY =====
    // Sistema avan√ßado de recomenda√ß√£o personalizada de v√≠deos
    
    // 1. ESTRUTURA DE BANCO DE DADOS COMPLETA
    let database = {
        usuarios: [
            {
                id: 1,
                nome: "Ana Silva",
                localizacao_atual: [-46.6333, -23.5505],
                historico_locais: [
                    { coordenadas: [-46.6333, -23.5505], timestamp: new Date('2024-01-10'), categoria: 'centro' },
                    { coordenadas: [-46.6320, -23.5490], timestamp: new Date('2024-01-12'), categoria: 'padaria' },
                    { coordenadas: [-46.6340, -23.5520], timestamp: new Date('2024-01-14'), categoria: 'beleza' }
                ],
                preferencias: {
                    categorias: ["padaria", "cafe", "beleza"],
                    tags_preferidas: ["artesanal", "fresh", "qualidade", "atendimento"],
                    horarios_ativos: ["08:00-12:00", "18:00-22:00"]
                },
                pontuacao_afinidade: {
                    padaria: 0.9,
                    cafe: 0.8,
                    beleza: 0.95,
                    restaurante: 0.3,
                    moda: 0.6
                },
                data_cadastro: new Date('2024-01-08'),
                historico_interacoes: [
                    { video_id: 1, tipo: 'curtida', timestamp: new Date('2024-01-15T10:30:00'), tempo_assistido: 25 },
                    { video_id: 2, tipo: 'comentario', timestamp: new Date('2024-01-15T11:15:00'), tempo_assistido: 20 },
                    { video_id: 3, tipo: 'compartilhamento', timestamp: new Date('2024-01-15T12:00:00'), tempo_assistido: 18 }
                ],
                configuracoes_algoritmo: {
                    limite_distancia: 5,
                    peso_localizacao: 0.8,
                    peso_afinidade: 0.2,
                    modo_fallback: false
                }
            },
            {
                id: 2,
                nome: "Carlos Santos",
                localizacao_atual: [-46.6350, -23.5510],
                historico_localizacoes: [[-46.6350, -23.5510], [-46.6310, -23.5480]],
                categorias_preferidas: ["cafe", "restaurante"],
                historico_checkins: [2],
                historico_interacoes: [2, 3]
            },
            {
                id: 3,
                nome: "Mariana Costa",
                localizacao_atual: [-46.6300, -23.5470],
                historico_localizacoes: [[-46.6300, -23.5470], [-46.6340, -23.5520]],
                categorias_preferidas: ["beleza", "moda"],
                historico_checkins: [2, 3],
                historico_interacoes: [1, 3]
            },
            {
                id: 4,
                nome: "Jo√£o Oliveira",
                localizacao_atual: [-46.6380, -23.5530],
                historico_localizacoes: [[-46.6380, -23.5530], [-46.6320, -23.5490]],
                categorias_preferidas: ["padaria", "mercado"],
                historico_checkins: [1],
                historico_interacoes: [1]
            },
            {
                id: 5,
                nome: "Sofia Lima",
                localizacao_atual: [-46.6290, -23.5460],
                historico_localizacoes: [[-46.6290, -23.5460], [-46.6310, -23.5480]],
                categorias_preferidas: ["cafe", "livraria"],
                historico_checkins: [3],
                historico_interacoes: [2, 3]
            }
        ],
        
        videos: [
            {
                id: 1,
                titulo: "P√£es frescos saindo do forno!",
                descricao: "Nossos p√£es artesanais s√£o feitos com ingredientes selecionados!",
                localizacao: [-46.6320, -23.5490],
                categoria: "padaria",
                curtidas: 124,
                visualizacoes: 1250,
                comentarios: 12,
                compartilhamentos: 8,
                tags: ["artesanal", "fresh", "padaria", "qualidade", "tradicional"],
                tempo_medio_visualizacao: 15,
                tempo_total_video: 30,
                data_publicacao: new Date('2024-01-15T10:00:00'),
                empresa_id: 1,
                engajamento_score: 0.85,
                qualidade_score: 0.92
            },
            {
                id: 2,
                titulo: "Nail art incr√≠vel em processo!",
                descricao: "Unhas decoradas com muito carinho e t√©cnica!",
                localizacao: [-46.6340, -23.5520],
                categoria: "beleza",
                curtidas: 89,
                visualizacoes: 890,
                comentarios: 8,
                compartilhamentos: 5,
                tags: ["nail art", "beleza", "decoracao", "tecnica", "criatividade"],
                tempo_medio_visualizacao: 20,
                tempo_total_video: 25,
                data_publicacao: new Date('2024-01-15T11:00:00'),
                empresa_id: 2,
                engajamento_score: 0.78,
                qualidade_score: 0.88
            },
            {
                id: 3,
                titulo: "Latte art em a√ß√£o!",
                descricao: "O caf√© mais cremoso da regi√£o!",
                localizacao: [-46.6310, -23.5480],
                categoria: "cafe",
                curtidas: 156,
                visualizacoes: 1560,
                comentarios: 23,
                compartilhamentos: 12,
                tags: ["latte art", "cafe", "cremoso", "qualidade", "barista"],
                tempo_medio_visualizacao: 18,
                tempo_total_video: 22,
                data_publicacao: new Date('2024-01-15T12:00:00'),
                empresa_id: 3,
                engajamento_score: 0.91,
                qualidade_score: 0.89
            },
            {
                id: 4,
                titulo: "Pizza artesanal no forno a lenha",
                descricao: "Massa fermentada por 48h, ingredientes premium",
                localizacao: [-46.6360, -23.5540],
                categoria: "restaurante",
                curtidas: 203,
                visualizacoes: 2030,
                comentarios: 31,
                compartilhamentos: 18,
                tags: ["pizza", "artesanal", "forno lenha", "premium", "tradicional"],
                tempo_medio_visualizacao: 25,
                tempo_total_video: 35,
                data_publicacao: new Date('2024-01-15T13:00:00'),
                empresa_id: 4,
                engajamento_score: 0.94,
                qualidade_score: 0.96
            },
            {
                id: 5,
                titulo: "Corte masculino moderno",
                descricao: "T√©cnicas avan√ßadas de barbearia",
                localizacao: [-46.6280, -23.5450],
                categoria: "beleza",
                curtidas: 67,
                visualizacoes: 670,
                comentarios: 9,
                compartilhamentos: 4,
                tags: ["corte", "masculino", "moderno", "barbearia", "estilo"],
                tempo_medio_visualizacao: 12,
                tempo_total_video: 28,
                data_publicacao: new Date('2024-01-15T14:00:00'),
                empresa_id: 5,
                engajamento_score: 0.65,
                qualidade_score: 0.72
            },
            {
                id: 6,
                titulo: "Doces caseiros irresist√≠veis",
                descricao: "Brigadeiros gourmet e bolos personalizados",
                localizacao: [-46.6330, -23.5500],
                categoria: "doces",
                curtidas: 145,
                visualizacoes: 1450,
                comentarios: 19,
                compartilhamentos: 11,
                tags: ["doces", "caseiro", "brigadeiro", "gourmet", "personalizado"],
                tempo_medio_visualizacao: 16,
                tempo_total_video: 20,
                data_publicacao: new Date('2024-01-15T15:00:00'),
                empresa_id: 6,
                engajamento_score: 0.82,
                qualidade_score: 0.85
            },
            {
                id: 7,
                titulo: "Flores frescas para decora√ß√£o",
                descricao: "Arranjos personalizados para todos os eventos",
                localizacao: [-46.6370, -23.5550],
                categoria: "floricultura",
                curtidas: 92,
                visualizacoes: 920,
                comentarios: 14,
                compartilhamentos: 7,
                tags: ["flores", "decoracao", "arranjos", "eventos", "personalizado"],
                tempo_medio_visualizacao: 13,
                tempo_total_video: 18,
                data_publicacao: new Date('2024-01-15T16:00:00'),
                empresa_id: 7,
                engajamento_score: 0.71,
                qualidade_score: 0.78
            },
            {
                id: 8,
                titulo: "Smoothie detox energizante",
                descricao: "Ingredientes org√¢nicos para sua sa√∫de",
                localizacao: [-46.6290, -23.5470],
                categoria: "saude",
                curtidas: 178,
                visualizacoes: 1780,
                comentarios: 26,
                compartilhamentos: 15,
                tags: ["smoothie", "detox", "organico", "saude", "energia"],
                tempo_medio_visualizacao: 21,
                tempo_total_video: 24,
                data_publicacao: new Date('2024-01-15T17:00:00'),
                empresa_id: 8,
                engajamento_score: 0.87,
                qualidade_score: 0.91
            },
            {
                id: 9,
                titulo: "Roupas vintage √∫nicas",
                descricao: "Pe√ßas exclusivas dos anos 80 e 90",
                localizacao: [-46.6350, -23.5530],
                categoria: "moda",
                curtidas: 134,
                visualizacoes: 1340,
                comentarios: 17,
                compartilhamentos: 9,
                tags: ["vintage", "moda", "exclusivo", "retro", "estilo"],
                tempo_medio_visualizacao: 19,
                tempo_total_video: 26,
                data_publicacao: new Date('2024-01-15T18:00:00'),
                empresa_id: 9,
                engajamento_score: 0.79,
                qualidade_score: 0.83
            },
            {
                id: 10,
                titulo: "Livros raros e antiguidades",
                descricao: "Cole√ß√£o especial de primeiras edi√ß√µes",
                localizacao: [-46.6320, -23.5510],
                categoria: "livraria",
                curtidas: 76,
                visualizacoes: 760,
                comentarios: 11,
                compartilhamentos: 6,
                tags: ["livros", "raros", "antiguidades", "colecao", "edicoes"],
                tempo_medio_visualizacao: 14,
                tempo_total_video: 30,
                data_publicacao: new Date('2024-01-15T19:00:00'),
                empresa_id: 10,
                engajamento_score: 0.68,
                qualidade_score: 0.75
            },
            // V√≠deos adicionais para sistema de fallback
            {
                id: 11,
                titulo: "Hamb√∫rguer artesanal premium",
                descricao: "Carne angus, p√£o brioche e molhos especiais",
                localizacao: [-46.6400, -23.5600],
                categoria: "restaurante",
                curtidas: 298,
                visualizacoes: 2980,
                comentarios: 45,
                compartilhamentos: 23,
                tags: ["hamburguer", "artesanal", "premium", "angus", "gourmet"],
                tempo_medio_visualizacao: 28,
                tempo_total_video: 32,
                data_publicacao: new Date('2024-01-14T19:00:00'),
                empresa_id: 11,
                engajamento_score: 0.97,
                qualidade_score: 0.95
            },
            {
                id: 12,
                titulo: "Yoga matinal no parque",
                descricao: "Aulas ao ar livre para come√ßar bem o dia",
                localizacao: [-46.6250, -23.5400],
                categoria: "saude",
                curtidas: 189,
                visualizacoes: 1890,
                comentarios: 34,
                compartilhamentos: 19,
                tags: ["yoga", "matinal", "parque", "ar livre", "bem estar"],
                tempo_medio_visualizacao: 22,
                tempo_total_video: 25,
                data_publicacao: new Date('2024-01-14T07:00:00'),
                empresa_id: 12,
                engajamento_score: 0.88,
                qualidade_score: 0.86
            }
        ],
        
        empresas: [
            {
                id: 1,
                nome: "Padaria do Jo√£o",
                categoria: "padaria",
                localizacao: [-46.6320, -23.5490],
                avaliacoes: 127,
                media_avaliacao: 4.8,
                avaliacoes_com_foto: 89
            },
            {
                id: 2,
                nome: "Maria - Nail Designer",
                categoria: "beleza",
                localizacao: [-46.6340, -23.5520],
                avaliacoes: 94,
                media_avaliacao: 4.9,
                avaliacoes_com_foto: 76
            },
            {
                id: 3,
                nome: "Caf√© da Esquina",
                categoria: "cafe",
                localizacao: [-46.6310, -23.5480],
                avaliacoes: 203,
                media_avaliacao: 4.7,
                avaliacoes_com_foto: 145
            },
            {
                id: 4,
                nome: "Pizzaria Nonna",
                categoria: "restaurante",
                localizacao: [-46.6360, -23.5540],
                avaliacoes: 156,
                media_avaliacao: 4.6,
                avaliacoes_com_foto: 98
            },
            {
                id: 5,
                nome: "Barbearia Moderna",
                categoria: "beleza",
                localizacao: [-46.6280, -23.5450],
                avaliacoes: 78,
                media_avaliacao: 4.5,
                avaliacoes_com_foto: 52
            }
        ]
    };
    
    // Usu√°rio atual (simulado)
    let usuarioAtual = database.usuarios[0]; // Ana Silva
    
    // 2. VARI√ÅVEIS DO SISTEMA DE RECOMENDA√á√ÉO
    let sistemaRecomendacao = {
        distanciaUsuario: 0,
        afinidadeUsuario: 0,
        tempoUso: 0,
        pesoLocalizacao: 0.8,
        pesoAfinidade: 0.2,
        limiteDistancia: 5,
        modoFallback: false,
        videosMinimos: 20
    };
    
    // 3. FUN√á√ïES PRINCIPAIS DO SISTEMA DE RECOMENDA√á√ÉO
    
    // Calcular dist√¢ncia entre duas coordenadas (em km)
    function calcularDistancia(coord1, coord2) {
        const R = 6371; // Raio da Terra em km
        const dLat = (coord2[1] - coord1[1]) * Math.PI / 180;
        const dLon = (coord2[0] - coord1[0]) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(coord1[1] * Math.PI / 180) * Math.cos(coord2[1] * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }
    
    // Calcular tempo de uso do usu√°rio (em dias)
    function calcularTempoUso(usuario) {
        const agora = new Date();
        const cadastro = usuario.data_cadastro;
        const diffTime = Math.abs(agora - cadastro);
        return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    }
    
    // Atualizar pesos baseado no tempo de uso
    function atualizarPesos(usuario) {
        const tempoUso = calcularTempoUso(usuario);
        sistemaRecomendacao.tempoUso = tempoUso;
        
        if (tempoUso <= 7) {
            // Primeira semana: priorizar localiza√ß√£o
            const progressao = Math.min(tempoUso / 5, 1); // Progress√£o at√© o 5¬∫ dia
            sistemaRecomendacao.pesoLocalizacao = 0.8 - (progressao * 0.3); // 0.8 -> 0.5
            sistemaRecomendacao.pesoAfinidade = 0.2 + (progressao * 0.3); // 0.2 -> 0.5
            sistemaRecomendacao.limiteDistancia = 5;
        } else {
            // Ap√≥s primeira semana: equilibrar localiza√ß√£o e afinidade
            sistemaRecomendacao.pesoLocalizacao = 0.5;
            sistemaRecomendacao.pesoAfinidade = 0.5;
            sistemaRecomendacao.limiteDistancia = 10; // Expandir raio
        }
        
        // Atualizar configura√ß√µes do usu√°rio
        usuario.configuracoes_algoritmo.peso_localizacao = sistemaRecomendacao.pesoLocalizacao;
        usuario.configuracoes_algoritmo.peso_afinidade = sistemaRecomendacao.pesoAfinidade;
        usuario.configuracoes_algoritmo.limite_distancia = sistemaRecomendacao.limiteDistancia;
    }
    
    // Calcular afinidade do usu√°rio com um v√≠deo
    function calcularAfinidadeUsuario(video, usuario) {
        let afinidade = 0;
        
        // 1. Afinidade por categoria (peso 40%)
        const afinidadeCategoria = usuario.pontuacao_afinidade[video.categoria] || 0;
        afinidade += afinidadeCategoria * 0.4;
        
        // 2. Afinidade por tags (peso 30%)
        let tagsComuns = 0;
        video.tags.forEach(tag => {
            if (usuario.preferencias.tags_preferidas.includes(tag)) {
                tagsComuns++;
            }
        });
        const afinidadeTags = Math.min(tagsComuns / video.tags.length, 1);
        afinidade += afinidadeTags * 0.3;
        
        // 3. Hist√≥rico de intera√ß√µes (peso 20%)
        const interagiu = usuario.historico_interacoes.some(inter => inter.video_id === video.id);
        if (interagiu) {
            afinidade += 0.2;
        }
        
        // 4. Qualidade e engajamento do v√≠deo (peso 10%)
        const qualidadeMedia = (video.engajamento_score + video.qualidade_score) / 2;
        afinidade += qualidadeMedia * 0.1;
        
        return Math.min(afinidade, 1); // Limitar a 1
    }
    
    // F√≥rmula principal de pontua√ß√£o
    function calcularPontuacaoRecomendacao(video, usuario) {
        const distancia = calcularDistancia(usuario.localizacao_atual, video.localizacao);
        sistemaRecomendacao.distanciaUsuario = distancia;
        
        // Se estiver fora do limite de dist√¢ncia e n√£o for modo fallback, retornar 0
        if (distancia > sistemaRecomendacao.limiteDistancia && !sistemaRecomendacao.modoFallback) {
            return 0;
        }
        
        // Calcular componente de localiza√ß√£o (normalizado)
        const componenteLocalizacao = Math.max(0, 1 - (distancia / sistemaRecomendacao.limiteDistancia));
        
        // Calcular componente de afinidade
        const componenteAfinidade = calcularAfinidadeUsuario(video, usuario);
        sistemaRecomendacao.afinidadeUsuario = componenteAfinidade;
        
        // Aplicar f√≥rmula principal
        const pontuacao = (componenteLocalizacao * sistemaRecomendacao.pesoLocalizacao) + 
                        (componenteAfinidade * sistemaRecomendacao.pesoAfinidade);
        
        return pontuacao;
    }
    
    // Sistema de Fallback Inteligente
    function aplicarSistemaFallback(videosDisponiveis, usuario) {
        let videosValidos = videosDisponiveis.filter(video => {
            const distancia = calcularDistancia(usuario.localizacao_atual, video.localizacao);
            return distancia <= sistemaRecomendacao.limiteDistancia;
        });
        
        // Se n√£o h√° v√≠deos suficientes, ativar fallback
        if (videosValidos.length < sistemaRecomendacao.videosMinimos) {
            console.log(`üîÑ FALLBACK ATIVADO: Apenas ${videosValidos.length} v√≠deos encontrados (m√≠nimo: ${sistemaRecomendacao.videosMinimos})`);
            sistemaRecomendacao.modoFallback = true;
            
            // Expandir limite de dist√¢ncia gradualmente
            let limiteExpandido = sistemaRecomendacao.limiteDistancia;
            while (videosValidos.length < sistemaRecomendacao.videosMinimos && limiteExpandido <= 50) {
                limiteExpandido += 10;
                videosValidos = videosDisponiveis.filter(video => {
                    const distancia = calcularDistancia(usuario.localizacao_atual, video.localizacao);
                    return distancia <= limiteExpandido;
                });
                console.log(`üìç Expandindo para ${limiteExpandido}km: ${videosValidos.length} v√≠deos`);
            }
            
            // Se ainda n√£o h√° v√≠deos suficientes, preencher com alta afinidade
            if (videosValidos.length < sistemaRecomendacao.videosMinimos) {
                console.log("üéØ Preenchendo com v√≠deos de alta afinidade...");
                const videosAfinidade = videosDisponiveis
                    .filter(video => !videosValidos.includes(video))
                    .sort((a, b) => calcularAfinidadeUsuario(b, usuario) - calcularAfinidadeUsuario(a, usuario))
                    .slice(0, sistemaRecomendacao.videosMinimos - videosValidos.length);
                
                videosValidos = [...videosValidos, ...videosAfinidade];
            }
            
            usuario.configuracoes_algoritmo.modo_fallback = true;
        } else {
            sistemaRecomendacao.modoFallback = false;
            usuario.configuracoes_algoritmo.modo_fallback = false;
        }
        
        return videosValidos;
    }
    
    // Fun√ß√£o principal de recomenda√ß√£o
    function gerarRecomendacoes(usuario = usuarioAtual) {
        console.log("ü§ñ INICIANDO SISTEMA DE RECOMENDA√á√ÉO TAPPY");
        
        // 1. Atualizar localiza√ß√£o atual (simula GPS)
        atualizarLocalizacaoAtual(usuario);
        
        // 2. Atualizar pesos baseado no tempo de uso
        atualizarPesos(usuario);
        
        console.log(`üìä Configura√ß√µes: Localiza√ß√£o=${sistemaRecomendacao.pesoLocalizacao.toFixed(2)}, Afinidade=${sistemaRecomendacao.pesoAfinidade.toFixed(2)}, Limite=${sistemaRecomendacao.limiteDistancia}km`);
        
        // 3. Aplicar sistema de fallback
        let videosDisponiveis = aplicarSistemaFallback(database.videos, usuario);
        
        // 4. Calcular pontua√ß√µes e ordenar
        const videosComPontuacao = videosDisponiveis.map(video => {
            const pontuacao = calcularPontuacaoRecomendacao(video, usuario);
            return {
                ...video,
                pontuacao_recomendacao: pontuacao,
                distancia_usuario: calcularDistancia(usuario.localizacao_atual, video.localizacao),
                afinidade_usuario: calcularAfinidadeUsuario(video, usuario)
            };
        });
        
        // 5. Ordenar por pontua√ß√£o (decrescente)
        const videosOrdenados = videosComPontuacao
            .filter(video => video.pontuacao_recomendacao > 0)
            .sort((a, b) => b.pontuacao_recomendacao - a.pontuacao_recomendacao);
        
        console.log(`‚úÖ ${videosOrdenados.length} v√≠deos recomendados`);
        console.log("üèÜ Top 3 recomenda√ß√µes:");
        videosOrdenados.slice(0, 3).forEach((video, index) => {
            console.log(`${index + 1}. ${video.titulo} (Score: ${video.pontuacao_recomendacao.toFixed(3)}, Dist: ${video.distancia_usuario.toFixed(1)}km, Afinidade: ${video.afinidade_usuario.toFixed(2)})`);
        });
        
        return videosOrdenados;
    }
    
    // Atualizar localiza√ß√£o atual (simula GPS)
    function atualizarLocalizacaoAtual(usuario) {
        // Simula pequenas varia√ß√µes na localiza√ß√£o
        const variacao = 0.001; // ~100m
        const novaLat = usuario.localizacao_atual[1] + (Math.random() - 0.5) * variacao;
        const novaLng = usuario.localizacao_atual[0] + (Math.random() - 0.5) * variacao;
        
        // Adicionar ao hist√≥rico
        usuario.historico_locais.push({
            coordenadas: [...usuario.localizacao_atual],
            timestamp: new Date(),
            categoria: 'movimento'
        });
        
        // Atualizar localiza√ß√£o atual
        usuario.localizacao_atual = [novaLng, novaLat];
        
        // Manter apenas √∫ltimas 100 localiza√ß√µes
        if (usuario.historico_locais.length > 100) {
            usuario.historico_locais = usuario.historico_locais.slice(-100);
        }
    }
    
    // Registrar hist√≥rico de locais ao assistir v√≠deo
    function registrarHistoricoLocal(videoId, usuario) {
        const video = database.videos.find(v => v.id === videoId);
        if (video) {
            usuario.historico_locais.push({
                coordenadas: video.localizacao,
                timestamp: new Date(),
                categoria: video.categoria
            });
            
            console.log(`üìç Hist√≥rico local registrado: ${video.categoria} em ${video.localizacao}`);
        }
    }
    
    // Recalcular afinidade ap√≥s intera√ß√£o
    function recalcularAfinidade(videoId, tipoInteracao, tempoAssistido, usuario) {
        const video = database.videos.find(v => v.id === videoId);
        if (!video) return;
        
        // Registrar intera√ß√£o
        usuario.historico_interacoes.push({
            video_id: videoId,
            tipo: tipoInteracao,
            timestamp: new Date(),
            tempo_assistido: tempoAssistido || 0
        });
        
        // Atualizar pontua√ß√£o de afinidade da categoria
        const categoriaAtual = usuario.pontuacao_afinidade[video.categoria] || 0;
        let incremento = 0;
        
        switch(tipoInteracao) {
            case 'visualizacao':
                incremento = 0.01;
                break;
            case 'curtida':
                incremento = 0.05;
                break;
            case 'comentario':
                incremento = 0.08;
                break;
            case 'compartilhamento':
                incremento = 0.10;
                break;
        }
        
        // Bonus por tempo assistido (se assistiu mais de 70% do v√≠deo)
        if (tempoAssistido && video.tempo_total_video) {
            const percentualAssistido = tempoAssistido / video.tempo_total_video;
            if (percentualAssistido > 0.7) {
                incremento *= 1.5; // Bonus de 50%
            }
        }
        
        usuario.pontuacao_afinidade[video.categoria] = Math.min(categoriaAtual + incremento, 1);
        
        // Adicionar tags preferidas
        video.tags.forEach(tag => {
            if (!usuario.preferencias.tags_preferidas.includes(tag)) {
                // Adicionar tag se usu√°rio interagiu positivamente
                if (['curtida', 'comentario', 'compartilhamento'].includes(tipoInteracao)) {
                    usuario.preferencias.tags_preferidas.push(tag);
                }
            }
        });
        
        console.log(`üéØ Afinidade atualizada: ${video.categoria} = ${usuario.pontuacao_afinidade[video.categoria].toFixed(3)}`);
    }
    
    // 4. INTEGRA√á√ÉO COM INTERFACE DO USU√ÅRIO
    
    // Vari√°vel global para armazenar recomenda√ß√µes atuais
    let videosRecomendados = [];
    
    // Inicializar sistema de recomenda√ß√£o
    function inicializarSistemaRecomendacao() {
        console.log("üöÄ INICIALIZANDO SISTEMA DE RECOMENDA√á√ÉO TAPPY");
        videosRecomendados = gerarRecomendacoes(usuarioAtual);
        return videosRecomendados;
    }
    
    // Atualizar recomenda√ß√µes (chamado automaticamente)
    function atualizarRecomendacoes() {
        videosRecomendados = gerarRecomendacoes(usuarioAtual);
        
        // Atualizar interface do feed se estiver vis√≠vel
        const feedTab = document.getElementById('feed-tab');
        if (feedTab && !feedTab.classList.contains('hidden')) {
            atualizarFeedInterface();
        }
    }
    
    // Atualizar interface do feed com v√≠deos recomendados
    function atualizarFeedInterface() {
        // Esta fun√ß√£o seria chamada para atualizar a interface
        // Por enquanto, apenas registra no console
        console.log("üîÑ Interface do feed atualizada com novas recomenda√ß√µes");
    }
    
    // Fun√ß√£o chamada quando usu√°rio interage com v√≠deo
    function registrarInteracaoCompleta(videoId, tipoInteracao, tempoAssistido = null) {
        // 1. Recalcular afinidade
        recalcularAfinidade(videoId, tipoInteracao, tempoAssistido, usuarioAtual);
        
        // 2. Registrar hist√≥rico local
        registrarHistoricoLocal(videoId, usuarioAtual);
        
        // 3. Atualizar recomenda√ß√µes
        setTimeout(() => {
            atualizarRecomendacoes();
        }, 1000);
        
        console.log(`‚úÖ Intera√ß√£o registrada: ${tipoInteracao} no v√≠deo ${videoId}`);
    }
    
    // Fun√ß√£o para obter v√≠deos para o feed (substitui fun√ß√£o antiga)
    function obterConteudosParaFeed() {
        if (videosRecomendados.length === 0) {
            videosRecomendados = inicializarSistemaRecomendacao();
        }
        return videosRecomendados.slice(0, 10); // Retorna top 10
    }
    
    // Fun√ß√£o de teste do sistema completo
    function executarTestesRecomendacao() {
        console.log("üß™ EXECUTANDO TESTES DO SISTEMA DE RECOMENDA√á√ÉO");
        
        // Teste 1: Recomenda√ß√µes iniciais
        console.log("\nüìä TESTE 1: Recomenda√ß√µes iniciais");
        const recomendacoesIniciais = gerarRecomendacoes(usuarioAtual);
        
        // Teste 2: Simular intera√ß√£o e ver mudan√ßas
        console.log("\nüìä TESTE 2: Simulando intera√ß√£o com v√≠deo de beleza");
        registrarInteracaoCompleta(2, 'curtida', 20);
        
        // Teste 3: Simular mudan√ßa de localiza√ß√£o
        console.log("\nüìä TESTE 3: Simulando mudan√ßa de localiza√ß√£o");
        usuarioAtual.localizacao_atual = [-46.6340, -23.5520]; // Pr√≥ximo √† nail designer
        const recomendacoesPosLocalizacao = gerarRecomendacoes(usuarioAtual);
        
        // Teste 4: Testar sistema de fallback
        console.log("\nüìä TESTE 4: Testando sistema de fallback");
        usuarioAtual.localizacao_atual = [-46.7000, -23.6000]; // Localiza√ß√£o distante
        const recomendacoesFallback = gerarRecomendacoes(usuarioAtual);
        
        // Restaurar localiza√ß√£o original
        usuarioAtual.localizacao_atual = [-46.6333, -23.5505];
        
        console.log("\n‚úÖ TESTES CONCLU√çDOS COM SUCESSO!");
        console.log(`üìà Sistema processou ${database.videos.length} v√≠deos`);
        console.log(`üë§ Usu√°rio: ${usuarioAtual.nome} (${calcularTempoUso(usuarioAtual)} dias de uso)`);
        console.log(`‚öôÔ∏è Configura√ß√£o atual: Loc=${sistemaRecomendacao.pesoLocalizacao.toFixed(2)}, Afinidade=${sistemaRecomendacao.pesoAfinidade.toFixed(2)}`);
    }
    
    // 5. FUN√á√ÉO PARA ORDENAR EMPRESAS
    function ordenarEmpresas(usuario = usuarioAtual) {
        const empresasComPontuacao = database.empresas.map(empresa => {
            const proximidade = calcularProximidadeScore({localizacao: empresa.localizacao}, usuario);
            const afinidade = usuario.categorias_preferidas.includes(empresa.categoria) ? 100 : 0;
            const checkin = usuario.historico_checkins.includes(empresa.id) ? 50 : 0;
            const qualidade = empresa.media_avaliacao * 20;
            
            const pontuacao = (proximidade * 0.4) + (afinidade * 0.3) + (checkin * 0.2) + (qualidade * 0.1);
            
            return {
                ...empresa,
                pontuacao_algoritmo: pontuacao
            };
        });
        
        return empresasComPontuacao.sort((a, b) => b.pontuacao_algoritmo - a.pontuacao_algoritmo);
    }
    
    // 6. FUN√á√ïES DE ATUALIZA√á√ÉO AUTOM√ÅTICA
    function atualizarLocalizacaoUsuario(novaLocalizacao) {
        usuarioAtual.historico_localizacoes.push(usuarioAtual.localizacao_atual);
        usuarioAtual.localizacao_atual = novaLocalizacao;
        
        // Manter apenas as √∫ltimas 50 localiza√ß√µes
        if (usuarioAtual.historico_localizacoes.length > 50) {
            usuarioAtual.historico_localizacoes = usuarioAtual.historico_localizacoes.slice(-50);
        }
        
        // Reordenar conte√∫dos automaticamente
        conteudosOrdenados = ordenarConteudos();
        empresasOrdenadas = ordenarEmpresas();
    }
    
    function registrarInteracao(conteudoId, tipoInteracao) {
        if (!usuarioAtual.historico_interacoes.includes(conteudoId)) {
            usuarioAtual.historico_interacoes.push(conteudoId);
        }
        
        // Atualizar estat√≠sticas do conte√∫do
        const conteudo = database.conteudos.find(c => c.id === conteudoId);
        if (conteudo) {
            switch(tipoInteracao) {
                case 'curtida':
                    conteudo.curtidas++;
                    break;
                case 'comentario':
                    conteudo.comentarios++;
                    break;
                case 'compartilhamento':
                    conteudo.compartilhamentos++;
                    break;
            }
        }
        
        // Atualizar afinidade com categoria
        if (conteudo && !usuarioAtual.categorias_preferidas.includes(conteudo.categoria)) {
            usuarioAtual.categorias_preferidas.push(conteudo.categoria);
        }
        
        // Reordenar conte√∫dos
        conteudosOrdenados = ordenarConteudos();
    }
    
    function registrarCheckin(empresaId) {
        if (!usuarioAtual.historico_checkins.includes(empresaId)) {
            usuarioAtual.historico_checkins.push(empresaId);
        }
        
        // Reordenar empresas
        empresasOrdenadas = ordenarEmpresas();
    }
    
    // 7. INICIALIZA√á√ÉO DO SISTEMA
    let conteudosOrdenados = ordenarConteudos();
    let empresasOrdenadas = ordenarEmpresas();
    
    // 8. TESTE AUTOM√ÅTICO (executado silenciosamente)
    function executarTestesAlgoritmo() {
        console.log("üîç EXECUTANDO TESTES DO ALGORITMO TAPPY");
        
        // Teste 1: Verificar ordena√ß√£o inicial
        console.log("üìä Top 3 conte√∫dos para Ana Silva:");
        conteudosOrdenados.slice(0, 3).forEach((conteudo, index) => {
            console.log(`${index + 1}. ${conteudo.titulo} (Score: ${conteudo.pontuacao_algoritmo.toFixed(2)})`);
        });
        
        // Teste 2: Simular mudan√ßa de localiza√ß√£o
        console.log("\nüìç Simulando mudan√ßa de localiza√ß√£o...");
        const localizacaoAntiga = [...usuarioAtual.localizacao_atual];
        atualizarLocalizacaoUsuario([-46.6340, -23.5520]); // Pr√≥ximo √† Maria - Nail Designer
        
        console.log("üìä Top 3 conte√∫dos ap√≥s mudan√ßa de localiza√ß√£o:");
        conteudosOrdenados.slice(0, 3).forEach((conteudo, index) => {
            console.log(`${index + 1}. ${conteudo.titulo} (Score: ${conteudo.pontuacao_algoritmo.toFixed(2)})`);
        });
        
        // Teste 3: Simular intera√ß√£o
        console.log("\n‚ù§Ô∏è Simulando curtida no conte√∫do de nail art...");
        registrarInteracao(2, 'curtida');
        
        console.log("üìä Top 3 conte√∫dos ap√≥s intera√ß√£o:");
        conteudosOrdenados.slice(0, 3).forEach((conteudo, index) => {
            console.log(`${index + 1}. ${conteudo.titulo} (Score: ${conteudo.pontuacao_algoritmo.toFixed(2)})`);
        });
        
        // Restaurar localiza√ß√£o original
        usuarioAtual.localizacao_atual = localizacaoAntiga;
        conteudosOrdenados = ordenarConteudos();
        
        console.log("\n‚úÖ Testes do algoritmo conclu√≠dos com sucesso!");
    }
    
    // Inicializar sistema de recomenda√ß√£o automaticamente
    setTimeout(() => {
        inicializarSistemaRecomendacao();
        executarTestesRecomendacao();
    }, 2000);
    
    // 9. FUN√á√ÉO PARA OBTER CONTE√öDOS ORDENADOS (usada pelo feed)
    function obterConteudosParaFeed() {
        return conteudosOrdenados.slice(0, 10); // Retorna top 10
    }
    
    function obterEmpresasParaMapa() {
        return empresasOrdenadas.slice(0, 20); // Retorna top 20
    }
    
    // ===== FIM DO SISTEMA DE ALGORITMO =====

    // ===== SISTEMA DE NOTIFICA√á√ïES =====
    
    // Base de dados de notifica√ß√µes
    let notificationsData = [
        {
            id: 1,
            type: 'new_video',
            title: 'Novo v√≠deo pr√≥ximo!',
            message: 'Padaria do Jo√£o postou: "Croissants frescos saindo do forno!"',
            icon: 'üçû',
            time: '2 min atr√°s',
            read: false,
            business: 'Padaria do Jo√£o',
            action: 'Ver v√≠deo'
        },
        {
            id: 2,
            type: 'promotion',
            title: 'Promo√ß√£o especial! üéâ',
            message: 'Maria Nail Designer: 20% OFF em nail art at√© sexta-feira',
            icon: 'üíÖ',
            time: '15 min atr√°s',
            read: false,
            business: 'Maria - Nail Designer',
            action: 'Ver oferta'
        },
        {
            id: 3,
            type: 'social',
            title: 'Algu√©m curtiu seu v√≠deo',
            message: 'Carlos Santos curtiu seu v√≠deo sobre o caf√© da manh√£',
            icon: '‚ù§Ô∏è',
            time: '1 hora atr√°s',
            read: true,
            business: null,
            action: 'Ver perfil'
        },
        {
            id: 4,
            type: 'checkin_reminder',
            title: 'Que tal um check-in?',
            message: 'Voc√™ est√° perto do Caf√© da Esquina. J√° experimentou o latte especial?',
            icon: 'üìç',
            time: '2 horas atr√°s',
            read: false,
            business: 'Caf√© da Esquina',
            action: 'Fazer check-in'
        }
    ];
    
    // Configura√ß√µes de notifica√ß√£o
    let notificationSettings = {
        newVideos: true,
        promotions: true,
        checkinReminders: false,
        socialInteractions: true,
        silentHours: {
            enabled: true,
            start: '22:00',
            end: '08:00'
        }
    };
    
    // Fun√ß√µes do sistema de notifica√ß√µes
    function toggleNotifications() {
        const panel = document.getElementById('notifications-panel');
        const isHidden = panel.classList.contains('hidden');
        
        if (isHidden) {
            panel.classList.remove('hidden');
            loadNotifications();
            // Marcar √≠cone como ativo
            document.getElementById('notification-icon').textContent = 'üîî';
        } else {
            panel.classList.add('hidden');
        }
    }
    
    function loadNotifications() {
        const notificationsList = document.getElementById('notifications-list');
        const unreadCount = notificationsData.filter(n => !n.read).length;
        
        // Atualizar badge
        const badge = document.getElementById('notification-badge');
        if (unreadCount > 0) {
            badge.textContent = unreadCount;
            badge.classList.remove('hidden');
        } else {
            badge.classList.add('hidden');
        }
        
        // Renderizar notifica√ß√µes
        notificationsList.innerHTML = notificationsData.map(notification => `
            <div class="p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer ${!notification.read ? 'bg-blue-50' : ''}" 
                 onclick="handleNotificationClick(${notification.id})">
                <div class="flex items-start space-x-3">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg" 
                         style="background-color: ${getNotificationColor(notification.type)};">
                        ${notification.icon}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <p class="font-semibold text-sm text-gray-900 truncate">${notification.title}</p>
                            <span class="text-xs text-gray-500">${notification.time}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1 line-clamp-2">${notification.message}</p>
                        ${notification.action ? `<button class="text-xs text-tappy-blue font-semibold mt-2 hover:text-blue-600 transition-colors">${notification.action}</button>` : ''}
                    </div>
                    ${!notification.read ? '<div class="w-2 h-2 bg-tappy-blue rounded-full"></div>' : ''}
                </div>
            </div>
        `).join('');
        
        // Se n√£o h√° notifica√ß√µes
        if (notificationsData.length === 0) {
            notificationsList.innerHTML = `
                <div class="p-8 text-center text-gray-500">
                    <div class="text-4xl mb-2">üîî</div>
                    <p class="font-medium">Nenhuma notifica√ß√£o</p>
                    <p class="text-sm">Voc√™ est√° em dia!</p>
                </div>
            `;
        }
    }
    
    function getNotificationColor(type) {
        const colors = {
            'new_video': '#E3F2FD',
            'promotion': '#FFF3E0',
            'social': '#FCE4EC',
            'checkin_reminder': '#E8F5E8'
        };
        return colors[type] || '#F5F5F5';
    }
    
    function handleNotificationClick(notificationId) {
        const notification = notificationsData.find(n => n.id === notificationId);
        if (!notification) return;
        
        // Marcar como lida
        notification.read = true;
        
        // A√ß√µes baseadas no tipo
        switch(notification.type) {
            case 'new_video':
                toggleNotifications();
                showTab('feed');
                break;
            case 'promotion':
                toggleNotifications();
                showTab('map');
                break;
            case 'social':
                toggleNotifications();
                showTab('profile');
                break;
            case 'checkin_reminder':
                toggleNotifications();
                showTab('map');
                break;
        }
        
        // Recarregar notifica√ß√µes
        loadNotifications();
    }
    
    function markAllAsRead() {
        notificationsData.forEach(notification => {
            notification.read = true;
        });
        loadNotifications();
        
        // Feedback visual
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = '‚úì Marcadas como lidas';
        button.style.color = '#10B981';
        
        setTimeout(() => {
            button.textContent = originalText;
            button.style.color = '';
        }, 2000);
    }
    
    function openNotificationSettings() {
        document.getElementById('notification-settings-modal').classList.remove('hidden');
        toggleNotifications(); // Fechar painel
    }
    
    function closeNotificationSettings() {
        document.getElementById('notification-settings-modal').classList.add('hidden');
    }
    
    // Fun√ß√£o para adicionar nova notifica√ß√£o (simula√ß√£o)
    function addNotification(type, title, message, business = null) {
        const newNotification = {
            id: Date.now(),
            type: type,
            title: title,
            message: message,
            icon: getNotificationIcon(type),
            time: 'Agora',
            read: false,
            business: business,
            action: getNotificationAction(type)
        };
        
        notificationsData.unshift(newNotification);
        
        // Limitar a 20 notifica√ß√µes
        if (notificationsData.length > 20) {
            notificationsData = notificationsData.slice(0, 20);
        }
        
        // Atualizar badge se painel estiver fechado
        const panel = document.getElementById('notifications-panel');
        if (panel.classList.contains('hidden')) {
            const unreadCount = notificationsData.filter(n => !n.read).length;
            const badge = document.getElementById('notification-badge');
            badge.textContent = unreadCount;
            badge.classList.remove('hidden');
            
            // Anima√ß√£o do sino
            const icon = document.getElementById('notification-icon');
            icon.style.animation = 'bounce 0.5s ease-in-out';
            setTimeout(() => {
                icon.style.animation = '';
            }, 500);
        }
    }
    
    function getNotificationIcon(type) {
        const icons = {
            'new_video': 'üé¨',
            'promotion': 'üéâ',
            'social': '‚ù§Ô∏è',
            'checkin_reminder': 'üìç'
        };
        return icons[type] || 'üîî';
    }
    
    function getNotificationAction(type) {
        const actions = {
            'new_video': 'Ver v√≠deo',
            'promotion': 'Ver oferta',
            'social': 'Ver perfil',
            'checkin_reminder': 'Fazer check-in'
        };
        return actions[type] || 'Ver mais';
    }
    
    // Simulador de notifica√ß√µes em tempo real
    function startNotificationSimulator() {
        const simulatedNotifications = [
            {
                type: 'new_video',
                title: 'Novo v√≠deo pr√≥ximo!',
                message: 'Barbearia Moderna postou: "Corte degrad√™ perfeito em 5 minutos"',
                business: 'Barbearia Moderna'
            },
            {
                type: 'promotion',
                title: 'Oferta rel√¢mpago! ‚ö°',
                message: 'Pizzaria Nonna: Pizza grande por R$ 25,90 apenas hoje!',
                business: 'Pizzaria Nonna'
            },
            {
                type: 'social',
                title: 'Novo seguidor!',
                message: 'Mariana Costa come√ßou a te seguir',
                business: null
            }
        ];
        
        let index = 0;
        setInterval(() => {
            if (index < simulatedNotifications.length) {
                const notif = simulatedNotifications[index];
                addNotification(notif.type, notif.title, notif.message, notif.business);
                index++;
            }
        }, 30000); // Nova notifica√ß√£o a cada 30 segundos
    }
    
    // Inicializar sistema de notifica√ß√µes
    setTimeout(() => {
        loadNotifications();
        startNotificationSimulator();
    }, 2000);
    
    // ===== FIM DO SISTEMA DE NOTIFICA√á√ïES =====

    function showScreen(screenId) {
        const screens = ['welcome-screen', 'signup-screen', 'login-screen', 'main-app'];
        screens.forEach(screen => {
            document.getElementById(screen).classList.add('hidden');
        });
        
        const targetScreen = document.getElementById(screenId);
        targetScreen.classList.remove('hidden');
        
        if (screenId === 'signup-screen') {
            targetScreen.classList.add('slide-in-right');
        } else if (screenId === 'login-screen') {
            targetScreen.classList.add('slide-in-left');
        } else {
            targetScreen.classList.add('fade-in');
        }
    }

    function showMainApp() {
        showScreen('main-app');
        showTab('feed');
    }

    function showTab(tabName) {
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.add('hidden'));
        
        document.getElementById(tabName + '-tab').classList.remove('hidden');
        
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach(btn => {
            btn.classList.remove('text-tappy-blue');
            btn.classList.add('text-gray-400');
        });
        
        event.target.closest('.tab-btn').classList.remove('text-gray-400');
        event.target.closest('.tab-btn').classList.add('text-tappy-blue');
    }

    function toggleVideo(container) {
        const playBtn = container.querySelector('.play-btn');
        const textCenter = container.querySelector('.text-center');
        
        if (playBtn.textContent === '‚ñ∂') {
            playBtn.textContent = '‚è∏';
            container.style.background = 'linear-gradient(135deg, #1E90FF, #FFD700)';
            textCenter.innerHTML = '<div class="text-white font-bold text-lg animate-pulse">üé¨ Reproduzindo...</div>';
            
            // Registrar visualiza√ß√£o no sistema de recomenda√ß√£o
            const videoContainers = document.querySelectorAll('.video-container');
            const videoIndex = Array.from(videoContainers).indexOf(container);
            if (videoIndex >= 0 && videoIndex < 3) {
                const videoId = videoIndex + 1;
                // Simular tempo de visualiza√ß√£o ap√≥s 3 segundos
                setTimeout(() => {
                    registrarInteracaoCompleta(videoId, 'visualizacao', 15);
                }, 3000);
            }
        } else {
            playBtn.textContent = '‚ñ∂';
            container.style.background = '';
            // Restaura o conte√∫do original sem recarregar a p√°gina
            const originalText = container.closest('.bg-white').querySelector('h3').textContent.includes('Padaria') ? 
                'P√£es frescos saindo do forno!' : 
                container.closest('.bg-white').querySelector('h3').textContent.includes('Maria') ? 
                'Nail art incr√≠vel em processo!' : 
                'Latte art em a√ß√£o!';
            
            textCenter.innerHTML = `
                <div class="w-16 h-16 bg-white bg-opacity-90 rounded-full flex items-center justify-center mx-auto mb-2 shadow-lg hover-scale">
                    <span class="text-tappy-blue text-2xl play-btn">‚ñ∂</span>
                </div>
                <p class="text-gray-700 font-medium">${originalText}</p>
            `;
        }
    }

    function likeVideo(button) {
        const heart = button.querySelector('span');
        const countSpan = button.querySelector('.like-count');
        let count = parseInt(countSpan.textContent);
        
        if (heart.textContent === 'ü§ç') {
            heart.textContent = '‚ù§Ô∏è';
            heart.classList.add('heart-bounce');
            countSpan.textContent = count + 1;
            button.classList.remove('text-gray-600');
            button.classList.add('text-red-500');
            
            // Registrar intera√ß√£o no sistema de recomenda√ß√£o
            const videoIndex = Array.from(document.querySelectorAll('.like-btn')).indexOf(button);
            if (videoIndex >= 0 && videoIndex < 3) {
                const videoId = videoIndex + 1; // IDs 1, 2, 3 para os v√≠deos vis√≠veis
                registrarInteracaoCompleta(videoId, 'curtida', 25); // Simula tempo assistido
            }
        } else {
            heart.textContent = 'ü§ç';
            countSpan.textContent = count - 1;
            button.classList.remove('text-red-500');
            button.classList.add('text-gray-600');
        }
        
        setTimeout(() => heart.classList.remove('heart-bounce'), 600);
    }



    function openComments() {
        document.getElementById('comments-modal').classList.remove('hidden');
    }

    function closeComments() {
        document.getElementById('comments-modal').classList.add('hidden');
    }

    function shareVideo() {
        // Simula anima√ß√£o de compartilhamento
        const shareBtn = event.target;
        shareBtn.style.transform = 'scale(1.2)';
        setTimeout(() => shareBtn.style.transform = 'scale(1)', 200);
        
        // Registrar intera√ß√£o no sistema de recomenda√ß√£o
        const shareButtons = document.querySelectorAll('button[onclick="shareVideo()"]');
        const videoIndex = Array.from(shareButtons).indexOf(shareBtn);
        if (videoIndex >= 0 && videoIndex < 3) {
            const videoId = videoIndex + 1; // IDs 1, 2, 3 para os v√≠deos vis√≠veis
            registrarInteracaoCompleta(videoId, 'compartilhamento', 30); // Simula tempo assistido completo
        }
        
        // Simula compartilhamento
        alert('V√≠deo compartilhado! üì§');
    }

    function showBusinessCard(businessType) {
        const businesses = {
            padaria: {
                name: 'Padaria do Jo√£o',
                description: 'P√£es artesanais frescos todos os dias',
                icon: 'üçû',
                color: 'from-tappy-gold to-yellow-400',
                distance: '500m'
            },
            manicure: {
                name: 'Maria - Nail Designer',
                description: 'Nail art e cuidados com as unhas',
                icon: 'üíÖ',
                color: 'from-pink-400 to-purple-400',
                distance: '300m'
            },
            cafe: {
                name: 'Caf√© da Esquina',
                description: 'O melhor caf√© da regi√£o',
                icon: '‚òï',
                color: 'from-amber-600 to-orange-500',
                distance: '800m'
            }
        };
        
        const business = businesses[businessType];
        const content = `
            <div class="flex items-center space-x-4 mb-4">
                <div class="w-16 h-16 bg-gradient-to-r ${business.color} rounded-full flex items-center justify-center text-2xl">
                    ${business.icon}
                </div>
                <div class="flex-1 text-left">
                    <h3 class="font-bold text-lg">${business.name}</h3>
                    <p class="text-gray-600 text-sm">${business.description}</p>
                    <p class="text-tappy-blue text-sm">üìç ${business.distance} de voc√™</p>
                </div>
            </div>
            <div class="flex space-x-3">
                <button onclick="showBusinessProfile('${businessType}')" class="flex-1 bg-tappy-blue text-white py-3 rounded-xl font-semibold btn-hover">
                    Ver Perfil
                </button>
                <button onclick="openContactModal()" class="flex-1 bg-tappy-gold text-gray-800 py-3 rounded-xl font-semibold btn-hover">
                    Contato
                </button>
            </div>
        `;
        
        document.getElementById('business-card-content').innerHTML = content;
        document.getElementById('business-card').classList.remove('hidden');
    }

    function showBusinessProfile(businessType) {
        const businesses = {
            padaria: {
                name: 'Padaria do Jo√£o',
                description: 'Tradi√ß√£o em p√£es artesanais desde 1985. Utilizamos apenas ingredientes selecionados e receitas familiares.',
                icon: 'üçû',
                color: 'from-tappy-gold to-yellow-400',
                id: 1
            },
            manicure: {
                name: 'Maria - Nail Designer',
                description: 'Especialista em nail art com mais de 8 anos de experi√™ncia. Atendimento personalizado e t√©cnicas modernas.',
                icon: 'üíÖ',
                color: 'from-pink-400 to-purple-400',
                id: 2
            },
            cafe: {
                name: 'Caf√© da Esquina',
                description: 'Caf√© especial torrado artesanalmente. Ambiente aconchegante para trabalhar ou relaxar.',
                icon: '‚òï',
                color: 'from-amber-600 to-orange-500',
                id: 3
            }
        };
        
        const business = businesses[businessType];
        const content = `
            <div class="bg-gradient-to-r ${business.color} p-8 rounded-3xl text-white mb-6">
                <div class="text-6xl mb-4">${business.icon}</div>
                <h2 class="text-3xl font-bold mb-2">${business.name}</h2>
                <p class="opacity-90 mb-4">${business.description}</p>
                <div class="flex space-x-4">
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">‚≠ê 4.8</span>
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">üìç Pr√≥ximo</span>
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">üïí Aberto</span>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-4">V√≠deos Recentes</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div class="aspect-square bg-gradient-to-br ${business.color} rounded-xl hover-scale cursor-pointer"></div>
                    <div class="aspect-square bg-gradient-to-br ${business.color} rounded-xl hover-scale cursor-pointer"></div>
                    <div class="aspect-square bg-gradient-to-br ${business.color} rounded-xl hover-scale cursor-pointer"></div>
                    <div class="aspect-square bg-gradient-to-br ${business.color} rounded-xl hover-scale cursor-pointer"></div>
                </div>
            </div>
            
            <button onclick="fazerCheckin(${business.id})" class="w-full bg-tappy-gold text-gray-800 py-4 rounded-xl font-semibold btn-hover mb-4">
                üìç Fazer Check-in
            </button>
            
            <button onclick="openContactModal()" class="w-full bg-tappy-blue text-white py-4 rounded-xl font-semibold btn-hover mb-4">
                Entrar em Contato
            </button>
            
            <div class="grid grid-cols-3 gap-3">
                <button class="bg-gray-100 py-3 rounded-xl font-semibold text-gray-700 hover:bg-gray-200 transition-colors">
                    Seguir
                </button>
                <button class="bg-gray-100 py-3 rounded-xl font-semibold text-gray-700 hover:bg-gray-200 transition-colors">
                    Compartilhar
                </button>
                <button class="bg-gray-100 py-3 rounded-xl font-semibold text-gray-700 hover:bg-gray-200 transition-colors">
                    Salvar
                </button>
            </div>
        `;
        
        document.getElementById('business-profile-content').innerHTML = content;
        document.getElementById('business-profile-modal').classList.remove('hidden');
    }
    
    function fazerCheckin(empresaId) {
        // Registrar check-in no algoritmo (invis√≠vel ao usu√°rio)
        registrarCheckin(empresaId);
        
        // Feedback visual para o usu√°rio
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '‚úÖ Check-in realizado!';
        button.style.backgroundColor = '#10B981';
        button.style.color = 'white';
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.style.backgroundColor = '';
            button.style.color = '';
        }, 2000);
    }

    function closeBusinessProfile() {
        document.getElementById('business-profile-modal').classList.add('hidden');
    }

    function openContactModal() {
        document.getElementById('contact-modal').classList.remove('hidden');
    }

    function closeContactModal() {
        document.getElementById('contact-modal').classList.add('hidden');
    }

    function addComment() {
        const input = document.getElementById('comment-input');
        const commentText = input.value.trim();
        
        if (commentText === '') {
            return;
        }
        
        const commentsContainer = document.querySelector('#comments-modal .space-y-4');
        const newComment = document.createElement('div');
        newComment.className = 'flex space-x-3 fade-in';
        newComment.innerHTML = `
            <div class="w-8 h-8 bg-gradient-to-r from-tappy-blue to-tappy-gold rounded-full"></div>
            <div class="flex-1">
                <p class="font-semibold text-sm">Voc√™</p>
                <p class="text-gray-600 text-sm">${commentText}</p>
            </div>
        `;
        
        commentsContainer.appendChild(newComment);
        input.value = '';
        
        // Atualizar contador de coment√°rios no modal
        const modalTitle = document.querySelector('#comments-modal h3');
        const currentCount = commentsContainer.children.length;
        modalTitle.textContent = `Coment√°rios (${currentCount})`;
        
        // Atualizar contador de coment√°rios nos posts do feed
        const commentButtons = document.querySelectorAll('.tab-content:not(.hidden) button[onclick="openComments()"]');
        commentButtons.forEach(button => {
            const countSpan = button.querySelector('span:last-child');
            if (countSpan) {
                const count = parseInt(countSpan.textContent);
                countSpan.textContent = count + 1;
            }
        });
        
        // Registrar intera√ß√£o no sistema de recomenda√ß√£o
        // Assumindo que estamos comentando no primeiro v√≠deo vis√≠vel
        registrarInteracaoCompleta(1, 'comentario', 20);
        
        // Scroll para mostrar o novo coment√°rio
        commentsContainer.scrollTop = commentsContainer.scrollHeight;
    }

    // Permitir enviar coment√°rio com Enter
    document.addEventListener('DOMContentLoaded', function() {
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('comments-modal').classList.contains('hidden') === false) {
                const input = document.getElementById('comment-input');
                if (document.activeElement === input) {
                    addComment();
                }
            }
        });
    });

    // Vari√°veis globais do mapa
    let map;
    let userLocation = [-46.6333, -23.5505]; // S√£o Paulo como padr√£o
    let currentMapStyle = 'mapbox://styles/mapbox/streets-v12';
    let markers = [];

    // Dados dos neg√≥cios (simulando banco de dados)
    const businessData = [
        {
            id: 'padaria',
            name: 'Padaria do Jo√£o',
            description: 'P√£es artesanais frescos todos os dias',
            icon: 'üçû',
            color: '#FFD700',
            coordinates: [-46.6320, -23.5490],
            distance: '500m'
        },
        {
            id: 'manicure',
            name: 'Maria - Nail Designer',
            description: 'Nail art e cuidados com as unhas',
            icon: 'üíÖ',
            color: '#EC4899',
            coordinates: [-46.6340, -23.5520],
            distance: '300m'
        },
        {
            id: 'cafe',
            name: 'Caf√© da Esquina',
            description: 'O melhor caf√© da regi√£o',
            icon: '‚òï',
            color: '#D97706',
            coordinates: [-46.6310, -23.5480],
            distance: '800m'
        }
    ];

    // Inicializar Mapa Customizado (sem depend√™ncia externa)
    function initializeMap() {
        // Remover tela de loading
        document.getElementById('map-loading').classList.add('hidden');
        
        // Criar mapa customizado usando CSS e JavaScript
        createCustomMap();
    }

    function createCustomMap() {
        const mapContainer = document.getElementById('mapbox-container');
        
        // Criar fundo do mapa com gradiente
        mapContainer.innerHTML = `
            <div class="w-full h-full relative overflow-hidden" style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%);">
                <!-- Grid de ruas simulado -->
                <div class="absolute inset-0 opacity-20">
                    <div class="grid grid-cols-8 grid-rows-8 h-full w-full">
                        ${Array(64).fill().map(() => '<div class="border border-gray-400"></div>').join('')}
                    </div>
                </div>
                
                <!-- Elementos decorativos do mapa -->
                <div class="absolute top-10 left-10 w-20 h-8 bg-green-300 rounded opacity-60"></div>
                <div class="absolute top-20 right-16 w-16 h-16 bg-green-400 rounded-full opacity-50"></div>
                <div class="absolute bottom-20 left-20 w-24 h-12 bg-blue-200 rounded opacity-70"></div>
                <div class="absolute bottom-32 right-12 w-12 h-20 bg-green-300 rounded opacity-60"></div>
                
                <!-- Ruas principais -->
                <div class="absolute top-1/3 left-0 right-0 h-2 bg-gray-300 opacity-80"></div>
                <div class="absolute top-0 bottom-0 left-1/2 w-2 bg-gray-300 opacity-80"></div>
                <div class="absolute top-2/3 left-0 right-0 h-1 bg-gray-400 opacity-60"></div>
                <div class="absolute top-0 bottom-0 left-1/4 w-1 bg-gray-400 opacity-60"></div>
                
                <!-- Container para marcadores -->
                <div id="markers-container" class="absolute inset-0"></div>
            </div>
        `;
        
        // Adicionar marcadores
        addCustomMarkers();
    }

    function addCustomMarkers() {
        const markersContainer = document.getElementById('markers-container');
        
        // Adicionar marcador do usu√°rio
        const userMarker = document.createElement('div');
        userMarker.className = 'absolute z-20';
        userMarker.style.left = '50%';
        userMarker.style.top = '50%';
        userMarker.style.transform = 'translate(-50%, -50%)';
        userMarker.innerHTML = `
            <div class="relative">
                <div class="w-6 h-6 bg-blue-500 rounded-full shadow-lg animate-pulse border-4 border-white"></div>
                <div class="w-12 h-12 bg-blue-500 bg-opacity-20 rounded-full absolute -top-3 -left-3 animate-ping"></div>
            </div>
        `;
        markersContainer.appendChild(userMarker);
        
        // Posi√ß√µes dos neg√≥cios no mapa (em porcentagem)
        const businessPositions = [
            { id: 'padaria', left: '35%', top: '40%' },
            { id: 'manicure', left: '65%', top: '30%' },
            { id: 'cafe', left: '40%', top: '70%' }
        ];
        
        // Adicionar marcadores dos neg√≥cios
        businessPositions.forEach(position => {
            const business = businessData.find(b => b.id === position.id);
            if (business) {
                const marker = document.createElement('div');
                marker.className = 'absolute z-10 cursor-pointer hover-scale';
                marker.style.left = position.left;
                marker.style.top = position.top;
                marker.style.transform = 'translate(-50%, -50%)';
                marker.innerHTML = `
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-2xl animate-bounce transition-transform hover:scale-110" 
                             style="background-color: ${business.color};">
                            ${business.icon}
                        </div>
                        <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-white px-2 py-1 rounded shadow-md text-xs font-semibold whitespace-nowrap opacity-0 hover:opacity-100 transition-opacity">
                            ${business.name}
                        </div>
                    </div>
                `;
                
                // Adicionar evento de clique
                marker.addEventListener('click', () => {
                    showBusinessCard(business.id);
                    
                    // Anima√ß√£o de clique
                    const icon = marker.querySelector('div > div');
                    icon.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        icon.style.transform = 'scale(1)';
                    }, 200);
                });
                
                markersContainer.appendChild(marker);
            }
        });
    }

    function centerMapOnUser() {
        // Animar centraliza√ß√£o no usu√°rio
        const userMarker = document.querySelector('#markers-container .z-20');
        if (userMarker) {
            userMarker.style.animation = 'none';
            userMarker.style.transform = 'translate(-50%, -50%) scale(1.2)';
            
            setTimeout(() => {
                userMarker.style.transform = 'translate(-50%, -50%) scale(1)';
                userMarker.style.animation = '';
            }, 500);
        }
        
        // Feedback visual
        const button = event.target.closest('button');
        const originalContent = button.innerHTML;
        button.innerHTML = '<span class="text-xl">üéØ</span>';
        button.style.backgroundColor = '#1E90FF';
        button.style.color = 'white';
        
        setTimeout(() => {
            button.innerHTML = originalContent;
            button.style.backgroundColor = '';
            button.style.color = '';
        }, 1000);
    }

    function toggleMapStyle() {
        const mapContainer = document.getElementById('mapbox-container');
        const currentBg = mapContainer.querySelector('div').style.background;
        
        // Diferentes estilos de mapa
        const styles = [
            'linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%)', // Padr√£o
            'linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 50%, #CE93D8 100%)', // Roxo
            'linear-gradient(135deg, #E8F5E8 0%, #C8E6C9 50%, #A5D6A7 100%)', // Verde
            'linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 50%, #FFCC80 100%)'  // Laranja
        ];
        
        const currentIndex = styles.findIndex(style => currentBg.includes(style.split(' ')[1])) || 0;
        const nextIndex = (currentIndex + 1) % styles.length;
        
        mapContainer.querySelector('div').style.background = styles[nextIndex];
        
        // Feedback visual
        const button = event.target.closest('button');
        const originalContent = button.innerHTML;
        button.innerHTML = '<span class="text-xl">‚ú®</span>';
        
        setTimeout(() => {
            button.innerHTML = originalContent;
        }, 500);
    }

    // Modificar fun√ß√£o showTab para inicializar mapa quando necess√°rio
    function showTab(tabName) {
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.add('hidden'));
        
        document.getElementById(tabName + '-tab').classList.remove('hidden');
        
        // Inicializar mapa quando a aba for aberta pela primeira vez
        if (tabName === 'map' && !map) {
            setTimeout(() => {
                initializeMap();
            }, 100);
        }
        
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach(btn => {
            btn.classList.remove('text-tappy-blue');
            btn.classList.add('text-gray-400');
        });
        
        event.target.closest('.tab-btn').classList.remove('text-gray-400');
        event.target.closest('.tab-btn').classList.add('text-tappy-blue');
    }

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
        // Simular autoplay dos v√≠deos quando entram na tela
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const playBtn = entry.target.querySelector('.play-btn');
                    if (playBtn && playBtn.textContent === '‚ñ∂') {
                        setTimeout(() => {
                            playBtn.textContent = '‚è∏';
                            entry.target.style.background = 'linear-gradient(135deg, #1E90FF, #FFD700)';
                        }, 500);
                    }
                }
            });
        });

        document.querySelectorAll('.video-container').forEach(container => {
            observer.observe(container);
        });
    });
</script>
